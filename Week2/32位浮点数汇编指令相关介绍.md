---
<a href="http://xiaohaoyu.tk/2017/03/%E6%B5%AE%E7%82%B9%E6%95%B0%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4">原文链接</a>
---

# 浮点数汇编指令学习笔记

## 浮点数的表示
> 浮点数在计算机中的存储与表示与整数相比有很大不同，一个浮点数被分为三个部分，分别为符号位、阶数部分、尾数部分。具体内容可参考《深入理解计算机系统》第二章，在此不做说明

## 浮点寄存器
> 由于浮点数的表示和计算的特殊性，cpu中使用浮点寄存器来实现对浮点数的操作。

<p>不同架构的cpu的浮点存储器结构不同。如80486cpu集成了八个80位数据寄存器、三个16位寄存器：1个标记寄存器、1个控制寄存器、1个状态寄存器、两个48位寄存器：1个指令指针以及1个数据指针。而Alpha架构有32个64位的浮点寄存器。虽说浮点寄存器可将浮点数扩展为64位双精度格式乃至80位扩展精度格式，但每一个寄存器只可以存放一个浮点数（BCD、float、double、long double）。</p>

以下以80486为例对浮点寄存器做一些说明：
- 浮点寄存器是通过栈结构实现的
- 将80486的八个80位浮点寄存器用ST(n)表示(n=1,2,3,...,n)，每次浮点寄存器都是率先使用ST(0)而不能越过ST(0)使用之后的浮点寄存器
- 浮点寄存器的使用就是出栈压栈的过程，如当ST(0)存在数据时，若有其他浮点数需要存放到寄存器，则ST(0)中数据进入ST(1),新数据进入ST(0)

## 浮点汇编指令
> 以下的汇编指令比较常用 <br>
其中IN表示操作数入栈，OUT表示操作数出栈

|指令名称|使用格式|指令功能|
|:-----:|:-------:|:----------------:|
|FLD|FLD IN|将浮点数IN压入ST(0)中，IN(mem 32/64/80)|
|FILD|FILD IN|将整数IN压入ST(0)中，IN(mem 32/64/80)|
|FLDZ|FLDZ|将整数0.0压入ST(0)中|
|FLD1|FLD1|将1.0压入ST(0)中|
|FST|FST OUT|将ST(0)中数据送入OUT地址中|
|FSTP|FSTP OUT|将ST(0)中数据送入OUT地址中,并对ST(0)进行出栈操作|
|FIST|FIST OUT|将ST(0)中数据以整数形式送入OUT地址中|
|FISTP|FIST OUT|将ST(0)中数据以整数形式送入OUT地址中，并对ST(0)进行出栈操作|
|FCOM|FCOM IN|将IN地址数据与ST(0)数据进行比较，影响对应标志位|
|FTST|FTST|比较ST(0)是否为0.0影响对应标志位|
|FADD|FADD IN|将IN地址内数据与ST(0)做加法运算，将结果放入ST(0)|
|FADDP|FADDP ST(N),ST|将ST(N)与ST(0)做加法运算并将ST(N)出栈，将结果放入ST(0)|

还有很多乘法除法以及其他指令

**以上介绍基于32位cpu架构**

## 参考资料
1. 《C++反汇编与逆向分析技术揭秘》第二章
